```{r setup, include = FALSE, cache = FALSE}
knitr::opts_chunk$set(error = TRUE)
knitr::opts_chunk$set(warning=FALSE)
knitr::opts_chunk$set(message=FALSE)
knitr::opts_chunk$set(echo=T)
knitr::opts_chunk$set(cache=F)
```
### Homework Guidelines:

Please read [Homework Guidelines](../homework/guidelines.html). You must follow these guidelines. 


### Turning the Homework in:

*Please turn the homework in through canvas. You may use a pdf, html or word doc file to turn the assignment in.*

[PHP 1511 Assignment Link](https://canvas.brown.edu/courses/1075279/assignments/7694145)

[PHP 2511 Assignment Link](https://canvas.brown.edu/courses/1075280/assignments/7694144)


A randomized clinical trial was completed to compare the effectiveness of 2 rheumatoid arthritis treatments. The grip strength was measured on each of the patients at 4 time points: week 0, week 1, week 2 and week 3. Grip strength is a continuous outcome. The data set is complete and balanced. Note that only a subset of patients is included in the data set for this assignment. We are most interested in determining the association between treatment and grip strength. Each row of the data set contains the following six variables:

---------------------------------------------------------
Variable  Description
--------- ----------------------------------------------
id        subject ID number

trt       treatment indicator

          1 = treatment A
          
          2 = treatment B
          
Y0        Week 0 Grip Strength

Y1        Week 1 Grip Strength

Y2        Week 2 Grip Strength

Y3        Week 3 Grip Strength
---------------------------------------------------------

1.  One interesting feature of this type of longitudinal data is that we need to have both data in a ***wide*** format where each subject has one row of data and multiple measurements and a ***long*** format where each subject has multiple rows relating to their different times points. This homework has provided the data in the *wide* format but we need to use both *wide* and *long* in our analysis. Reshape this data to a long format. What do you notice about this data (completeness, design,..)

*Hint: use the `gather()` function*

Read data in:

```{r}
load(hw6.rda)
```

***If you cannot load the data via the rda file,  you can down load `comprgrip.csv` and read the data in that way. ***

2. Create two plots, one for each treatment group, showing the trajectories of each subjectâ€™s grip strength over time. Comment on the notable features in these trajectories.




3. Find the means and over time for each treatment and then plot these on a graph. You will be given code to calculate the means by group but you will need to use previous plotting codes to create the plot. Comment on any notable Features. 

*Note: use the `group_by()` command to help with means.*



4. Find the standard deviations and over time for each treatment and then plot these on a graph. Comment on any notable Features. 

*Note: use the `group_by()` command to help with standard deviations.*


5. We will perfrom the 2 stage analysis directly in this stage. 

  a. Model the change in grip strength for each individual.
    ```{R}
    library(nlme)
    reg.list <- lmList(Y ~ week| id, data=compgrip.long)
    ```
  b. We then would abstract the estimated model coefficients and the variance covariance matrices. 
    ```{r}
    b <- lapply(reg.list, coef)
    V <- lapply(reg.list, vcov)
    ```
  c. Finally we assign the correct values to a particular subject and run our final regressions 
  
    ```{R}
    library(metafor)
    estm <- rep(c("intercept","slope"), length(b))
    subj <- rep(names(b), each=2)
    b <- unlist(b)
    V <- bldiag(V)
    reg <- rma.mv(b ~ estm-1, V, random = ~ estm | subj, struct="UN")
    reg
    ```
  d. What do your results look like? *This should be similar to the paragraph in notes that details these steps*
  
6. Finally We will perform a mixed regression model to perform both stages at the same time. 
    a. Fit a Random Intercept Model. 
    b. Fit a Random Slope Model.
    c. Fit a Random Slope and Intercept Model. 
    d. Run the `anova()` command over all three and choose the best model. 
    e. Summarize what you find in steps a through d. 




7. Compare and Contrast the outputs from 5d and 6. *you only need to reference comparisons on the summaries made in the notes for these*
    