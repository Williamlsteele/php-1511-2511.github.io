---
output:
  html_document: default
  pdf_document: default
---
### Homework Guidelines:

Please read [Homework Guidelines](../homework/guidelines.html). You must follow these guidelines. 


### Turning the Homework in:

*Please turn the homework in through canvas. You may use a pdf, html or word doc file to turn the assignment in.*

[PHP 1511 Assignment Link](https://canvas.brown.edu/courses/1075279/assignments/7690066)

[PHP 2511 Assignment Link](https://canvas.brown.edu/courses/1075280/assignments/7690067)


***For the R Markdown Version of this assignment: [HW3.Rmd](../homework/hw3.Rmd)***


## Part 1: Both PHP 1511 and 2511 

Health disparities are very real and exist across individuals and populations. Before developing methods of remedying these disparities we need to be able to identify where there are disparities.In this homework we will consider a study by [(Asch & Armstrong, 2007)](http://www.ncbi.nlm.nih.gov/pubmed/17513818).  This paper considers 222 patients with localized prostate cancer. The table below partitions patients by race, hospital and whether or not the patient received a prostatectomy. 


<table>
<tbody>
<tr>
<td width="234">
<p>&nbsp;</p>
</td>
<td width="234">
<p>&nbsp;</p>
</td>
<td colspan="2" width="468">
<p>Undergoing Prostatectomy</p>
</td>
</tr>
<tr>
<td width="234">
<p>&nbsp;</p>
</td>
<td width="234">
<p>Race</p>
</td>
<td width="234">
<p>Yes</p>
</td>
<td width="234">
<p>No</p>
</td>
</tr>
<tr>
<td width="234">
<p>University Hospital</p>
</td>
<td width="234">
<p>White</p>
</td>
<td width="234">
<p>54</p>
</td>
<td width="234">
<p>37</p>
</td>
</tr>
<tr>
<td width="234">
<p>&nbsp;</p>
</td>
<td width="234">
<p>Black</p>
</td>
<td width="234">
<p>7</p>
</td>
<td width="234">
<p>5</p>
</td>
</tr>
<tr>
<td width="234">
<p>&nbsp;</p>
</td>
<td width="234">
<p>&nbsp;</p>
</td>
<td width="234">
<p>&nbsp;</p>
</td>
<td width="234">
<p>&nbsp;</p>
</td>
</tr>
<tr>
<td width="234">
<p>VA Hospital</p>
</td>
<td width="234">
<p>White</p>
</td>
<td width="234">
<p>11</p>
</td>
<td width="234">
<p>29</p>
</td>
</tr>
<tr>
<td width="234">
<p>&nbsp;</p>
</td>
<td width="234">
<p>Black</p>
</td>
<td width="234">
<p>22</p>
</td>
<td width="234">
<p>57</p>
</td>
</tr>
</tbody>
</table>



You can load this data into R with the code below:


```{r}
phil_disp <- read.table("https://drive.google.com/uc?export=download&id=0B8CsRLdwqzbzOXlIRl9VcjNJRFU", header=TRUE, sep=",")
```

This dataset contains the following variables

---------------------------------------------
Variable      Description
------------  -------------------------------
hospital      0 - University Hospital

              1 - VA Hospital

race          0 - White

              1 - Black
              
surgery       0 - No prostatectomy

              1 - Had Prostatectomy
---------------------------------------------

1. First, use logistic regression to obtain a crude estimate (i.e. collapsed over hospital) of the relationship of Black vs White men in Philadelphia with risk of receiving a prostatectomy. You can use the odds ratio for this purpose. Report the odds ratio, a 95% confidence interval and provide a brief interpretation. 
```{r,message=FALSE}
phil_disp$race <- factor(phil_disp$race, levels = c(0,1), labels = c("white","black"))
phil_disp$hospital <- factor(phil_disp$hospital, labels = c("Univ","VA"))
library(dplyr)
library(splitstackshape)
library(broom)
long_phil_disp <- expandRows(phil_disp, "number")
```

```{r}
m1 <- glm(surgery ~ race, data = long_phil_disp, family = binomial(link = "logit"))
tidy(m1, exponentiate = T, conf.int = T)[,-c(3,4)]
```

**If you consider a black male in this population they have an odds of receiving a prostatectomy 0.47 times that of a white male. The 95% interval doesn't contain 1, and this confirms that the difference between black males and white males is statistically significant at the 0.05 level. The result shows us the black males are less likely to receive the prostatectomy.**

2. Second, use logistic regression to obtain a crude estimate (i.e. collapsed over race) of the relationsh ip of VA hospital vs University Hospital in Philadelphia with risk of receiving a prostatectomy. You can use the odds ratio for this purpose. Report the odds ratio, a 95% confidence interval and provide a brief interpretation.
```{r}
m2 <- glm(surgery ~ hospital, data = long_phil_disp, family = binomial(link = "logit"))
tidy(m2, exponentiate = T, conf.int = T)[,-c(3,4)]
```

**If you consider people in VA hospital in this population they have an odds of receiving a prostatectomy 0.26 times that of people in university hospital. The 95% interval doesn't contain 1, and this confirms that the difference between these two hospitals is statistically significant at the 0.05 level. The result shows us the people in the VA hospital are less likely to receive the prostatectomy.**

3. Thirdly, use logistic regression to obtain an estimate of the relative odds of prostatectomy by race adjusted for hospital. Report the relative odds ratio, a 95% confidence interval and provide a brief interpretation for race. 
```{r}
m3 <- glm(surgery ~ hospital + race, data = long_phil_disp, family = binomial(link = "logit"))
tidy(m3, exponentiate = T, conf.int = T)[,-c(3,4)]
```

**If you consider a black male in this population they have an odds of receiving a prostatectomy 0.998 times that of a white male adjusting for hospital. The 95% interval contains 1, and this means that the difference between black males and white males is not statistically significant at the 0.05 level. The result shows us the black males are equal likely to receive the prostatectomy as the white males.**



4. How did the odds ratio change between questions 1 and 3? (***Hint:*** *Simpson's Paradox*)

**The magnitude odd's ratio become larger from Q1 to Q3. The 95% interval of odds ratio in Q1 doesn't include 1 but in Q3 it includes 1, Which means that in Q1 the difference between black males and white males is statistically significant at the 0.05 level but in Q3 the difference between black males and white males is not statistically significant at the 0.05 level. Simpson's Paradox is a phenomenon in probability and statistics, in which a trend appears in several different groups of data but disappears or reverses when these groups are combined. Here, we do observe the trend that the black male can be less likely to receive the prostatectomy in the whole population among these two hospitals. But the trend doesn't exist in the population within each hospital.**

5. Why is there such a change in the odds ratio between 1 and 3?

**Here, hospital can be a counfounder which skew the relationship between race and receiving a prostatectomy away from zero. That is to say, if we don't adjust to the confounder and we look into the whole population, we can find a relationship between race and receiving a prostatectomy, which was actually caused by the different treatments of the two hospital. The VA hospital gave less surgery and reveived more black people. If we look into a specific population in a certain hospital where people got the same treatment, this relationship is gone.**

***Note: This does not mean that race is not associated with prostatectomy, what it means is that when you adjust for the hospital race is no longer significant. Basically, both black and white males are equally likely to receive a prostatectomy at a given hospital. However, more black males go to the VA hospital which is less likely to provide a prostatectomy***

6. What does this tell you about disparities within this study?

**In the study, the different treatments between university hospital and VA hospital cause the different chances in receiving the prostatectomy. Since the VA hospital received more black people than white people and it provide less surgery, we may conclude that the black males are less likely to receive the prostatectomy if we don't adjust to the hospital.**

7. What challenges does this study provide in trying to identify health disparities?

**In this study we can see that even though we know there is a racial disparity, the correction for that disparity may not be easily seen. For example, if we had gone to each hospital and told them that we are going to monitor their actions and make sure they are giving the best treatment to all races, then they would look and see that they gave the same treatment to all races of males.** 

**What we find instead is that this is a problem with the hospital. This becomes more complex to figure out how to fix it since it is an access to quality care problem. We would then have to come up with policies to overcome it.** 

**This story displays how adjusting for confounding can help us get to the cause of a problem. We now know in this setting that we need to find a way to adjust the treatments at the VA or allow men who go there to have other hospital options instead.**

## Part 2: PHP 2511 Only

9. What is the purpose of the link function in a GLM? 


**Many times with GLMs our outcome is not something that can be on a linear scale. Many times this is due to the values of our outcome having a narrow range of values when a linear relationship can go from $-\infty$ to $\infty$. We use the link function so that our model can be linear with the link function of our outcome of interest.**


10. What is the basic reasoning behind using the logit link for logistic regression? 

**1.The response variable has binary outcomes, if we model the probability directly with the systematic part, say $P(Y=1)=X\beta$, the left-side part can only take values from 0 to 1, but the linear combination part can take any value from the real line. To remove the problem of range restrictions, we use the logit link to transform the probability into the log odds ratio, which can take values from $-\infty$ to $\infty$.**  

**2.Easy to interpretate.**

11. What are the assumptions of a GLM?

**1. The data $Y_1,Y_2,.,Y_n$ are independently distributed. **

**2. The dependent variable $Y_i$ is from an exponential family.**

**3. Linear Relationship between link function and systematic component. **

**4. Errors are independent.**
